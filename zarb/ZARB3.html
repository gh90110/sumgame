<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تمرین جدول ضرب</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        
        :root {
            --primary-color: #2B3467;
            --secondary-color: #EB455F;
            --success-color: #2B7A0B;
            --error-color: #D21312;
            --bg-color: #f4f4f4;
        }

        body {
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            text-align: center;
            padding: 20px;
            margin: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 30px;
        }

        .game-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            margin: 10px 0;
        }

        label {
            font-size: 1.1rem;
            display: block;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        select, button {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border-radius: 10px;
            border: 2px solid #ddd;
            font-family: 'Vazirmatn';
            transition: all 0.3s ease;
        }

        select:focus, button:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 52, 103, 0.2);
        }

        .start-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 20px;
        }

        .start-btn:hover {
            background-color: #1A2238;
            transform: translateY(-2px);
        }

        .game-area {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            background-color: #f8f9fa;
            display: none;
        }

        .game-active .game-area {
            display: block;
        }

        .question {
            font-size: 2.5rem;
            margin: 20px 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            padding: 15px;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .calculator {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 400px;
            margin: 30px auto;
        }

        .calculator button {
            font-size: 1.5rem;
            padding: 15px;
            background-color: white;
            border: 2px solid #eee;
            cursor: pointer;
        }

        .calculator button:hover {
            background-color: #f0f0f0;
        }

        .calculator .action-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
        }

        .feedback {
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: fadeIn 0.3s ease;
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .correct {
            background-color: #C7F4C2;
            color: var(--success-color);
            display: block;
        }

        .wrong {
            background-color: #FFDEDE;
            color: var(--error-color);
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 1s linear;
            width: 100%;
        }

        .practice-list {
            margin-top: 30px;
            text-align: right;
        }

        .practice-item {
            background-color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .shapes {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .shape {
            width: 15px;
            height: 15px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .end-game-summary {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .summary-item {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            .question {
                font-size: 2rem;
            }

            .calculator {
                gap: 8px;
            }

            .calculator button {
                font-size: 1.2rem;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>تمرین جدول ضرب 🎲</h1>
        <div class="game-controls">
            <div class="input-group">
                <label for="number">عدد مورد نظر:</label>
                <select id="number">
                    <option value="1">۱</option>
                    <option value="2">۲</option>
                    <option value="3">۳</option>
                    <option value="4">۴</option>
                    <option value="5">۵</option>
                    <option value="6">۶</option>
                    <option value="7">۷</option>
                    <option value="8">۸</option>
                    <option value="9">۹</option>
                    <option value="10">۱۰</option>
                </select>
            </div>
            <div class="input-group">
                <label for="mode">حالت تمرین:</label>
                <select id="mode">
                    <option value="ordered">منظم</option>
                    <option value="random">تصادفی</option>
                    <option value="challenge">چالشی</option>
                </select>
            </div>
            <div class="input-group">
                <label for="difficulty">سطح دشواری:</label>
                <select id="difficulty">
                    <option value="easy">آسان (۱۵ ثانیه)</option>
                    <option value="medium">متوسط (۱۰ ثانیه)</option>
                    <option value="hard">سخت (۵ ثانیه)</option>
                </select>
            </div>
        </div>
        
        <button class="start-btn" onclick="startGame()">شروع بازی 🎮</button>

        <div class="game-area">
            <div class="question" id="question"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div id="timer">زمان کل: ۶۰ ثانیه</div>
                </div>
                <div class="stat-item">
                    <div id="questionTimer">زمان سوال: ۱۰ ثانیه</div>
                </div>
                <div class="stat-item">
                    <div id="score">امتیاز: ۰</div>
                </div>
                <div class="stat-item">
                    <div id="streak">توالی پاسخ صحیح: ۰</div>
                </div>
            </div>
            <div class="feedback" id="feedback"></div>

            <div class="calculator" id="calculator">
                <button onclick="addDigit('1')">۱</button>
                <button onclick="addDigit('2')">۲</button>
                <button onclick="addDigit('3')">۳</button>
                <button onclick="addDigit('4')">۴</button>
                <button onclick="addDigit('5')">۵</button>
                <button onclick="addDigit('6')">۶</button>
                <button onclick="addDigit('7')">۷</button>
                <button onclick="addDigit('8')">۸</button>
                <button onclick="addDigit('9')">۹</button>
                <button onclick="addDigit('0')">۰</button>
                <button class="action-btn" onclick="submitAnswer()">تأیید ✓</button>
                <button class="action-btn" onclick="clearAnswer()">پاک کردن ⌫</button>
            </div>
        </div>

        <div class="end-game-summary" id="gameSummary"></div>

        <div class="practice-list" id="practiceList">
            <h3>لیست تمرین برای مرور 📝</h3>
        </div>
    </div>

    <script>
        let currentNumber = 1;
let currentMultiplier = 1;
let score = 0;
let streak = 0;
let timeLeft = 60;
let questionTimeLeft = 10;
let timer;
let questionTimer;
let practiceList = [];
let userAnswer = '';
let isGameActive = false;
let maxStreak = 0;
let totalQuestions = 0;
let correctAnswers = 0;

function startGame() {
    if (isGameActive) {
        if (!confirm('آیا می‌خواهید بازی فعلی را متوقف کرده و بازی جدیدی را شروع کنید؟')) {
            return;
        }
    }

    resetGame();
    const number = parseInt(document.getElementById('number').value);
    const mode = document.getElementById('mode').value;
    const difficulty = document.getElementById('difficulty').value;

    setDifficultyTimes(difficulty);
    currentNumber = number;
    currentMultiplier = getInitialMultiplier(mode);
    isGameActive = true;

    document.querySelector('.game-area').style.display = 'block';
    document.getElementById('gameSummary').style.display = 'none';

    updateStats();
    startTimers();
    askQuestion();

    document.body.classList.add('game-active');
}

function resetGame() {
    score = 0;
    streak = 0;
    maxStreak = 0;
    totalQuestions = 0;
    correctAnswers = 0;
    userAnswer = '';
    practiceList = [];
    clearPracticeList();
    clearFeedback();
}

function setDifficultyTimes(difficulty) {
    switch(difficulty) {
        case 'easy':
            questionTimeLeft = 15;
            timeLeft = 90;
            break;
        case 'medium':
            questionTimeLeft = 10;
            timeLeft = 60;
            break;
        case 'hard':
            questionTimeLeft = 5;
            timeLeft = 45;
            break;
    }
}

function getInitialMultiplier(mode) {
    return mode === 'ordered' ? 1 : Math.floor(Math.random() * 10) + 1;
}

function updateStats() {
    document.getElementById('score').textContent = `امتیاز: ${score}`;
    document.getElementById('streak').textContent = `توالی پاسخ صحیح: ${streak}`;
    document.getElementById('timer').textContent = `زمان کل: ${timeLeft} ثانیه`;
    document.getElementById('questionTimer').textContent = `زمان سوال: ${questionTimeLeft} ثانیه`;
    
    const progressPercent = (questionTimeLeft / getInitialQuestionTime()) * 100;
    document.getElementById('progressFill').style.width = `${progressPercent}%`;
}

function getInitialQuestionTime() {
    const difficulty = document.getElementById('difficulty').value;
    switch(difficulty) {
        case 'easy': return 15;
        case 'medium': return 10;
        case 'hard': return 5;
        default: return 10;
    }
}

function startTimers() {
    clearInterval(timer);
    clearInterval(questionTimer);

    timer = setInterval(() => {
        timeLeft--;
        updateStats();
        if (timeLeft <= 0) {
            endGame();
        }
    }, 1000);

    startQuestionTimer();
}

function startQuestionTimer() {
    clearInterval(questionTimer);
    questionTimeLeft = getInitialQuestionTime();
    updateStats();

    questionTimer = setInterval(() => {
        questionTimeLeft--;
        updateStats();
        if (questionTimeLeft <= 0) {
            handleTimeout();
        }
    }, 1000);
}

function askQuestion() {
    if (!isGameActive) return;

    const mode = document.getElementById('mode').value;
    if (mode === 'challenge') {
        currentNumber = Math.floor(Math.random() * 10) + 1;
        currentMultiplier = Math.floor(Math.random() * 10) + 1;
    } else if (mode === 'random') {
        currentMultiplier = Math.floor(Math.random() * 10) + 1;
    }

    document.getElementById('question').textContent = 
        `${convertToFarsiNumbers(currentNumber)} × ${convertToFarsiNumbers(currentMultiplier)} = ؟`;
    clearFeedback();
    userAnswer = '';
    startQuestionTimer();
    totalQuestions++;
}

function convertToFarsiNumbers(num) {
    const farsiDigits = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
    return num.toString().split('').map(c => farsiDigits[c]).join('');
}

function addDigit(digit) {
    if (!isGameActive) return;
    userAnswer += digit;
    showAnswer();
}

function showAnswer() {
    document.getElementById('question').textContent = 
        `${convertToFarsiNumbers(currentNumber)} × ${convertToFarsiNumbers(currentMultiplier)} = ${convertToFarsiNumbers(userAnswer)}`;
}

function clearAnswer() {
    if (!isGameActive) return;
    userAnswer = '';
    document.getElementById('question').textContent = 
        `${convertToFarsiNumbers(currentNumber)} × ${convertToFarsiNumbers(currentMultiplier)} = ؟`;
}

function submitAnswer() {
    if (!isGameActive || userAnswer === '') return;

    const correctAnswer = currentNumber * currentMultiplier;
    clearInterval(questionTimer);

    if (parseInt(userAnswer) === correctAnswer) {
        handleCorrectAnswer();
    } else {
        handleWrongAnswer(correctAnswer);
    }

    updateStats();
    setTimeout(() => {
        if (isGameActive) {
            nextQuestion();
        }
    }, 1500);
}

function handleCorrectAnswer() {
    score += 5 + (streak * 2); // امتیاز بیشتر برای پاسخ‌های متوالی
    streak++;
    maxStreak = Math.max(maxStreak, streak);
    correctAnswers++;
    showFeedback(true, 'آفرین! پاسخ درست است 🎉');
}

function handleWrongAnswer(correctAnswer) {
    score = Math.max(0, score - 3);
    streak = 0;
    showFeedback(false, `متأسفانه اشتباه است. جواب صحیح: ${convertToFarsiNumbers(correctAnswer)}`);
    addToPracticeList(currentNumber, currentMultiplier, correctAnswer);
}

function handleTimeout() {
    const correctAnswer = currentNumber * currentMultiplier;
    score = Math.max(0, score - 2);
    streak = 0;
    showFeedback(false, `زمان تمام شد! جواب صحیح: ${convertToFarsiNumbers(correctAnswer)}`);
    addToPracticeList(currentNumber, currentMultiplier, correctAnswer);
    
    setTimeout(() => {
        if (isGameActive) {
            nextQuestion();
        }
    }, 1500);
}

function showFeedback(isCorrect, message) {
    const feedback = document.getElementById('feedback');
    feedback.textContent = message;
    feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'wrong');
    feedback.style.display = 'block';
}

function clearFeedback() {
    const feedback = document.getElementById('feedback');
    feedback.style.display = 'none';
    feedback.className = 'feedback';
}

function nextQuestion() {
    const mode = document.getElementById('mode').value;
    if (mode === 'ordered') {
        currentMultiplier++;
        if (currentMultiplier > 10) {
            endGame();
            return;
        }
    }
    askQuestion();
}

function addToPracticeList(num1, num2, answer) {
    practiceList.push({
        num1: num1,
        num2: num2,
        answer: answer
    });
}

function clearPracticeList() {
    document.getElementById('practiceList').innerHTML = '<h3>لیست تمرین برای مرور 📝</h3>';
}

function showPracticeList() {
    const practiceListElement = document.getElementById('practiceList');
    practiceList.forEach(item => {
        const practiceItem = document.createElement('div');
        practiceItem.className = 'practice-item';
        practiceItem.innerHTML = `
            <div>${convertToFarsiNumbers(item.num1)} × ${convertToFarsiNumbers(item.num2)} = ${convertToFarsiNumbers(item.answer)}</div>
            <div class="shapes">
                ${Array.from({ length: item.answer }, (_, i) => `<div class="shape"></div>`).join('')}
            </div>
        `;
        practiceListElement.appendChild(practiceItem);
    });
}

function endGame() {
    isGameActive = false;
    clearInterval(timer);
    clearInterval(questionTimer);
    document.body.classList.remove('game-active');
    document.querySelector('.game-area').style.display = 'none';

    const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
    const summaryElement = document.getElementById('gameSummary');
    summaryElement.style.display = 'block';
    summaryElement.innerHTML = `
        <h2>پایان بازی! 🎮</h2>
        <div class="summary-item">امتیاز نهایی: ${convertToFarsiNumbers(score)}</div>
        <div class="summary-item">بیشترین توالی پاسخ صحیح: ${convertToFarsiNumbers(maxStreak)}</div>
        <div class="summary-item">تعداد کل سوالات: ${convertToFarsiNumbers(totalQuestions)}</div>
        <div class="summary-item">پاسخ‌های صحیح: ${convertToFarsiNumbers(correctAnswers)}</div>
        <div class="summary-item">دقت: ${convertToFarsiNumbers(accuracy)}٪</div>
    `;

    showPracticeList();
}

// اضافه کردن پشتیبانی از کیبورد
document.addEventListener('keydown', (event) => {
    if (!isGameActive) return;

    if (event.key >= '0' && event.key <= '9') {
        addDigit(event.key);
    } else if (event.key === 'Enter') {
        submitAnswer();
    } else if (event.key === 'Backspace') {
        clearAnswer();
    }
});